---
title: skynet 设计初衷以及特性
date: 2022-06-20
categories: ['skynet']
description: 
toc: true
pin: true
draft: false
---



# 概述

> `skynet` 是一个基于消息和服务的`Actor`分布式服务框架，
采用`go`编写，致力于简化开发难度和成本。

它是一个年轻的框架，仅仅经历了两款项目的迭代 现在版本为 `v1.6.0 2023-05-28` 
- [羽翼军团](https://www.taptap.cn/app/229839) v1.3.0
- [我在民国淘古玩](https://www.taptap.cn/app/215934) v.1.3.5

至于什么是`Actor`是必要了解的概念，[skynet](https://github.com/cloudwu/skynet) 以及 `erlang` 都是基于这种模式。


<!--more-->

# 设计目的

+ 过往的工作中曾经开发了一个`cobweb`的分布式服务器框架（基于`golang`,`c`）,但是在实际开发过程中代码难以维护以及更新，主要是每次都需要跨平台进行编译，特别是`cgo` 往往需要指定平台的系统库,而且一些不规范的使用方式造成无法充分发挥多核的优势，可以参见 `关于Go协程的思考` 虽然1.16 支持抢占式，但错误的使用方式依然造成了cpu过高的问题。

+ 再者，服务器过多的 `goroutine` 被创建，极大浪费了内存以及cpu。我不希望滥用协程，其代价比预估的要高。

+ 由于以上目的，重写了`cobweb` 的底层，底层对用户不再透明。而是通过脚本语言导出来提供支持

+ 在2024/03我重新用C实现了一版以提供更好的性能和更底层的控制

+ 包括后续的[DSL](/post/typelang/1)

## Processor

一个伪线程的逻辑处理器概念，它分为独占和负载两种模式，独占`Processor`是为了更好的处理实时性更高的业务，它不会被其他任务抢占`Processor`,而负载`Processor`又可分为两种运行态，均匀的处理业务以及从其他`Processor`上偷窃任务，尽量保证`Processor`不会过于闲置，除此之外，负载`Processor`可随着任务的变动而增加（不会超过最大设定值），特别的当某个任务陷入”死循环”或者是超出设定运行阈值的时候会重新创建一个`Processor`，并让之前的挂起（在C版本中将会被强制关闭）。




# 特性
  1. 支持纯`Lua`编码， 原因在于 `lua` 是一门简单并且性能很高的脚本语言，能显著降低开发成本，而且`skynet`本身提供了丰富的接口

  `pure go`或者`cgo`也同样支持,而且性能会更好

  后续会替换新的脚本语言 [typelang](/post/typelang/1)

  2. mysql,redis,mongo dbserver 支持
    值得注意的是这些库都是作为插件实现，跟主库关联不大，需要编译时指定

  1. 网络支持（http,tcp,udp,raw socket）

  2. 内置集群组件 [sktpmd](/post/skynet/sktpmd),做平了本地和远程的调用界限

  3. 重新实现的http框架，区别于 `net/http`,仅仅实现部分 `RFC` 标准,兼容此框架的网络库，提供更好的性能
  
  4. 隐藏的数据编码，对业务不透明，基与比`protobuf-v3` 更快的编码 [kproto](/post/kproto)

  5. 无任何lua模块,仅有一个执行文件和一个配置文件
  
  6. 超快的性能，完全摒弃`interface{}`以及各种抽象，采用`Pointer`的方式创建数据（仅底层，业务层无须关心）


# 架构

+ `skynet` 是函数式以及低抽象的架构,纯函数式主要是受 `c` 的影响。纯函数也更贴合职责单一的原则,而低抽象是因为`go interface` 并非零成本抽象，它有一定的性能代价。所以整个`skynet` 没有任何接口定义

+ `skynet`仅需要一个执行文件，大小仅仅`5.78mb`,默认运行内存仅仅 `2.2mb`，

+ `65535 Lua`服务仅占用`1.8GB`,也就是每个 `Lua服务` 仅占用 `28.8kb`

+ `65535 纯go`服务仅占用`120mb`,每个`pure go`服务仅占用 `1.9kb`

+ 纯C版本持续开发中。。。



{{< adsense-footer>}}
